<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZEROPRESS</title>
  <link rel="stylesheet" href="/assets/client-entry-UI1mcJZ-.css">
  <body>
    <div id="root"><header class="pc:fixed absolute left-0 top-0 z-50 w-full"><div class="border-divider bg-bg-default h-nav border-b px-[12px] pt-px transition-colors duration-300"><div class="flex h-full items-center justify-between"><div class="flex h-full justify-start"><div class="h-full"><nav class="mx-[12px] flex h-full items-center"><a class="cursor-pointer"><img src="/logo.jpg" class="h-[24px] w-[24px]"/></a></nav></div></div><div class="flex h-full justify-end"><div class="h-full"><nav class="mx-[12px] h-full justify-end"><a class="cursor-pointer text-text-2 text-hover flex h-full items-center whitespace-nowrap text-[14px] font-[500]">笔记</a></nav></div><div class="h-full"><nav class="mx-[12px] h-full justify-end"><a class="cursor-pointer text-text-2 text-hover flex h-full items-center whitespace-nowrap text-[14px] font-[500]">测试</a></nav></div><div class="h-full"><nav class="mx-[12px] h-full justify-end"><a class="cursor-pointer text-brand text-hover flex h-full items-center whitespace-nowrap text-[14px] font-[500]">离谱</a></nav></div><div class="h-full"><nav class="mx-[4px] flex h-full items-center"><button class="bg-bg-switch border-divider hover:border-gray-1 relative h-[22px] w-[40px] rounded-[11px] border transition-colors duration-300"><div class="bg-bg-inverse shadow-1 absolute left-px top-px h-[18px] w-[18px] overflow-hidden rounded-[50%] transition-all duration-300 dark:translate-x-[18px]"><span class="*:text-text-2 *:absolute *:left-[3px] *:top-[3px] *:h-[12px] *:w-[12px] *:transition-opacity *:duration-300"><div class="icon-[carbon--sun] opacity-100 dark:opacity-0"></div><div class="icon-[carbon--moon] opacity-0 dark:opacity-100"></div></span></div></button></nav></div><div class="h-full"><nav class="mx-[12px] h-full"><a href="https://github.com/houhongxu/hhxpress" class="cursor-pointer text-text-2 text-hover flex  h-full items-center"><span class="icon-[carbon--logo-github] h-[24px] w-[24px]"></span></a></nav></div></div></div></div></header><div class="pt-nav"><aside class="mt-nav w-sidebar border-divider bg-bg-sidebar pc:-translate-x-0 fixed inset-y-0 left-0 z-40 -translate-x-full overflow-y-auto border-r px-[28px] py-[16px] transition-transform duration-300"><div class="border-divider mt-[4px] border-t first:mt-0 first:border-t-0"><h2 class="text-text-1 mb-[6px] mt-[12px] flex cursor-pointer items-center justify-between font-[700]"><span>ahooks</span><span class="rotate-90 icon-[carbon--chevron-right] transition-transform duration-300"></span></h2><div style="height:270px" class="mb-[12px] flex flex-col overflow-hidden pl-[1rem] transition-[height] duration-300"><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useLocalStorageState与useSessionStorageState</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useUpdateEffect 与 useUpdateLayoutEffectt</a><a class="cursor-pointer text-brand text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useLatest与useMemoizedFn</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">use(Raf)Timeout与use(Raf)Interval与useCountDown</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useRequest</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useMount与useUnMount与useMountedRefx.md</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useUpdate</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useCreation</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useDeepCompareEffect</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useAnimationFrame和计时器</a></div></div></aside><div class="pc:ml-sidebar ml-0 flex justify-between"><div class="mx-auto w-full max-w-[768px] transition-[margin] duration-300"><div class="h-nav pc:hidden bg-bg-default sticky top-0 z-50 w-full border-b"><div class="flex h-full items-center justify-between px-[24px]"><a class="icon-[carbon--list] h-[24px] w-[24px] cursor-pointer"></a><a class="icon-[carbon--border-top] h-[24px] w-[24px] cursor-pointer"></a></div><div class="fixed inset-0 bg-[#00000060] transition-all duration-300 opacity-0 invisible"></div><aside class="w-sidebar border-divider bg-bg-sidebar fixed inset-y-0 left-0 z-40 overflow-y-auto border-r px-[28px] py-[16px] transition-transform duration-300 -translate-x-full"><div class="border-divider mt-[4px] border-t first:mt-0 first:border-t-0"><h2 class="text-text-1 mb-[6px] mt-[12px] flex cursor-pointer items-center justify-between font-[700]"><span>ahooks</span><span class="rotate-90 icon-[carbon--chevron-right] transition-transform duration-300"></span></h2><div style="height:270px" class="mb-[12px] flex flex-col overflow-hidden pl-[1rem] transition-[height] duration-300"><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useLocalStorageState与useSessionStorageState</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useUpdateEffect 与 useUpdateLayoutEffectt</a><a class="cursor-pointer text-brand text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useLatest与useMemoizedFn</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">use(Raf)Timeout与use(Raf)Interval与useCountDown</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useRequest</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useMount与useUnMount与useMountedRefx.md</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useUpdate</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useCreation</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useDeepCompareEffect</a><a class="cursor-pointer text-text-2 text-hover mb-[2px] overflow-hidden text-ellipsis whitespace-nowrap p-[2px] text-[14px]">useAnimationFrame和计时器</a></div></div></aside><div class="fixed inset-0  bg-[#00000060] transition-all duration-300 opacity-0 invisible"></div><aside class="w-toc border-divider bg-bg-sidebar fixed inset-y-0 right-0 z-40  h-full border-l px-[28px] py-[16px] transition-transform duration-300 translate-x-full"><div class="border-divider pc:border-l px-[16px] font-[500]"><div class="pc:block bg-brand absolute left-0 hidden h-[18px] w-px transition-[opacity,top] duration-300" style="top:33px;opacity:0"></div><div class="text-[14px] font-[600] leading-[28px]">本页目录</div><div><div><a href="#uselatest" class="text-text-2 text-hover block overflow-hidden text-ellipsis whitespace-nowrap text-[13px] leading-[28px]" style="padding-left:0rem">useLatest</a></div><div><a href="#usememoizedfn" class="text-text-2 text-hover block overflow-hidden text-ellipsis whitespace-nowrap text-[13px] leading-[28px]" style="padding-left:0rem">useMemoizedFn</a></div></div></div></aside></div><div class="p-[48px]"><div class="doc"><h1 id="uselatest-与-usememoizedfn"><a class="autolink-headings" href="#uselatest-与-usememoizedfn"><span style="margin-right:4px">#</span></a>useLatest 与 useMemoizedFn</h1>
<h2 id="uselatest"><a class="autolink-headings" href="#uselatest"><span style="margin-right:4px">#</span></a>useLatest</h2>
<p>获取最新值的 hook，但是不能避免对象的地址改变</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="ts" data-theme="github-light"><code data-language="ts" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#6A737D">// 每次渲染都将最新的value存到ref中，但是value如果是引用类型地址还是会变</span></span>
<span data-line=""><span style="color:#D73A49">function</span><span style="color:#6F42C1"> useLatest</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">T</span><span style="color:#24292E">&gt;(</span><span style="color:#E36209">value</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> T</span><span style="color:#24292E">) {</span></span>
<span data-line=""><span style="color:#D73A49">  const</span><span style="color:#005CC5"> ref</span><span style="color:#D73A49"> =</span><span style="color:#6F42C1"> useRef</span><span style="color:#24292E">(value)</span></span>
<span data-line=""><span style="color:#24292E">  ref.current </span><span style="color:#D73A49">=</span><span style="color:#24292E"> value</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">  return</span><span style="color:#24292E"> ref</span></span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<h2 id="usememoizedfn"><a class="autolink-headings" href="#usememoizedfn"><span style="margin-right:4px">#</span></a>useMemoizedFn</h2>
<p>获取最新更新了状态的最新函数的 hook，而且函数地址不变，理论上可以替换 useCallback</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="ts" data-theme="github-light"><code data-language="ts" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">type</span><span style="color:#6F42C1"> noop</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> any</span><span style="color:#24292E">, </span><span style="color:#D73A49">...</span><span style="color:#E36209">args</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> any</span><span style="color:#24292E">[]) </span><span style="color:#D73A49">=&gt;</span><span style="color:#005CC5"> any</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// https://github.com/alibaba/hooks/pull/1470</span></span>
<span data-line=""><span style="color:#D73A49">type</span><span style="color:#6F42C1"> PickFunction</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">T</span><span style="color:#D73A49"> extends</span><span style="color:#6F42C1"> noop</span><span style="color:#24292E">&gt; </span><span style="color:#D73A49">=</span><span style="color:#24292E"> (</span></span>
<span data-line=""><span style="color:#005CC5">  this</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> ThisParameterType</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">T</span><span style="color:#24292E">&gt;,</span></span>
<span data-line=""><span style="color:#D73A49">  ...</span><span style="color:#E36209">args</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> Parameters</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">T</span><span style="color:#24292E">&gt;</span></span>
<span data-line=""><span style="color:#24292E">) </span><span style="color:#D73A49">=&gt;</span><span style="color:#6F42C1"> ReturnType</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">T</span><span style="color:#24292E">&gt;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// 返回更新了状态但是地址不变的fn</span></span>
<span data-line=""><span style="color:#D73A49">function</span><span style="color:#6F42C1"> useMemoizedFn</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">T</span><span style="color:#D73A49"> extends</span><span style="color:#6F42C1"> noop</span><span style="color:#24292E">&gt;(</span><span style="color:#E36209">fn</span><span style="color:#D73A49">:</span><span style="color:#6F42C1"> T</span><span style="color:#24292E">) {</span></span>
<span data-line=""><span style="color:#6A737D">  // 开发环境日志</span></span>
<span data-line=""><span style="color:#D73A49">  if</span><span style="color:#24292E"> (isDev) {</span></span>
<span data-line=""><span style="color:#D73A49">    if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#6F42C1">isFunction</span><span style="color:#24292E">(fn)) {</span></span>
<span data-line=""><span style="color:#24292E">      console.</span><span style="color:#6F42C1">error</span><span style="color:#24292E">(</span></span>
<span data-line=""><span style="color:#032F62">        `useMemoizedFn expected parameter is a function, got ${</span><span style="color:#D73A49">typeof</span><span style="color:#24292E"> fn</span><span style="color:#032F62">}`</span><span style="color:#24292E">,</span></span>
<span data-line=""><span style="color:#24292E">      )</span></span>
<span data-line=""><span style="color:#24292E">    }</span></span>
<span data-line=""><span style="color:#24292E">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">  // fnRef因为适配所以分开写</span></span>
<span data-line=""><span style="color:#6A737D">  // 本质就是fnRef=useLatest(fn)</span></span>
<span data-line=""><span style="color:#6A737D">  // 注意fnRef.current的地址会改变</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">  // 使用useRef保存最新的fn</span></span>
<span data-line=""><span style="color:#D73A49">  const</span><span style="color:#005CC5"> fnRef</span><span style="color:#D73A49"> =</span><span style="color:#6F42C1"> useRef</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">T</span><span style="color:#24292E">&gt;(fn)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">  // 适配 react devtool</span></span>
<span data-line=""><span style="color:#6A737D">  // why not write `fnRef.current = fn`?</span></span>
<span data-line=""><span style="color:#6A737D">  // https://github.com/alibaba/hooks/issues/728</span></span>
<span data-line=""><span style="color:#24292E">  fnRef.current </span><span style="color:#D73A49">=</span><span style="color:#6F42C1"> useMemo</span><span style="color:#24292E">(() </span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E"> fn, [fn])</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">  // 初始化memoizedFn，memoizedFn.current的函数地址不会改变</span></span>
<span data-line=""><span style="color:#D73A49">  const</span><span style="color:#005CC5"> memoizedFn</span><span style="color:#D73A49"> =</span><span style="color:#6F42C1"> useRef</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">PickFunction</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">T</span><span style="color:#24292E">&gt;&gt;()</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">  // 只有初始化时赋值</span></span>
<span data-line=""><span style="color:#D73A49">  if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#24292E">memoizedFn.current) {</span></span>
<span data-line=""><span style="color:#6A737D">    // 这里的第一个参数this是适配eslint的eslint no-invalid-this https://github.com/alibaba/hooks/pull/1464</span></span>
<span data-line=""><span style="color:#6A737D">    // 这里是防止函数地址改变才包裹一层function</span></span>
<span data-line=""><span style="color:#6A737D">    // 防止函数this指向丢失使用apply调用</span></span>
<span data-line=""><span style="color:#24292E">    memoizedFn.</span><span style="color:#6F42C1">current</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> function</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">, </span><span style="color:#D73A49">...</span><span style="color:#E36209">args</span><span style="color:#24292E">) {</span></span>
<span data-line=""><span style="color:#D73A49">      return</span><span style="color:#24292E"> fnRef.current.</span><span style="color:#6F42C1">apply</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">, args)</span></span>
<span data-line=""><span style="color:#24292E">    }</span></span>
<span data-line=""><span style="color:#24292E">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">  // 返回的memoizedFn.current始终是通过function包裹的fn.current，fn.current保证是最新的函数</span></span>
<span data-line=""><span style="color:#D73A49">  return</span><span style="color:#24292E"> memoizedFn.current </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> T</span></span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure></div><footer class="mt-[32px]"><div class="border-divider flex justify-between border-t pt-[24px]"><div class="w-[calc(50%-4px)]"><a class="cursor-pointer border-divider hover:border-brand group block h-full w-full rounded-[8px] border px-[16px] py-[8px] transition-colors duration-300"><div class="text-text-2 text-[12px] font-[500] leading-[20px]">上一页</div><div class=" text-text-2 group-hover:text-brand overflow-hidden text-ellipsis whitespace-nowrap text-[14px] font-[500] leading-[20px] transition-colors duration-300">useUpdateEffect 与 useUpdateLayoutEffectt</div></a></div><div class="w-[calc(50%-4px)]"><a class="cursor-pointer border-divider hover:border-brand group block h-full w-full rounded-[8px] border px-[16px] py-[8px] transition-colors duration-300"><div class="text-text-2 text-[12px] font-[500] leading-[20px]">下一页</div><div class=" text-text-2 group-hover:text-brand overflow-hidden text-ellipsis whitespace-nowrap text-[14px] font-[500] leading-[20px] transition-colors duration-300">use(Raf)Timeout与use(Raf)Interval与useCountDown</div></a></div></div></footer></div></div><aside class="w-toc full:flex sticky top-[calc(theme(spacing.nav)+48px)] hidden h-full flex-col"><div class="border-divider pc:border-l px-[16px] font-[500]"><div class="pc:block bg-brand absolute left-0 hidden h-[18px] w-px transition-[opacity,top] duration-300" style="top:33px;opacity:0"></div><div class="text-[14px] font-[600] leading-[28px]">本页目录</div><div><div><a href="#uselatest" class="text-text-2 text-hover block overflow-hidden text-ellipsis whitespace-nowrap text-[13px] leading-[28px]" style="padding-left:0rem">useLatest</a></div><div><a href="#usememoizedfn" class="text-text-2 text-hover block overflow-hidden text-ellipsis whitespace-nowrap text-[13px] leading-[28px]" style="padding-left:0rem">useMemoizedFn</a></div></div></div></aside></div></div></div>
  
    <script type="module" src="/client-entry.js"></script>
    </body>
    
</html>
